#!/bin/bash
#
# Utilities

info() {
    printf "$(tput setaf 7)- %s$(tput sgr0)\n" "$@"
}

success() {
    printf "$(tput setaf 64)âœ“ %s$(tput sgr0)\n" "$@"
}

error() {
    printf "$(tput setaf 1)x %s$(tput sgr0)\n" "$@"
}

warning() {
    printf "$(tput setaf 136)! %s$(tput sgr0)\n" "$@"
}

# Ask for confirmation before proceeding
seek_confirmation() {
    warning "$@"
    read -p "? Continue (y/n) " -n 1
    printf "\n"
}

# Test whether the result of an `seek_confirmation` is a confirmation
is_confirmed() {
    if [[ "$REPLY" =~ ^[Yy]$ ]]; then
      return 0
    fi
    return 1
}

# Test whether a command exists
type_exists() {
  if type $1 > /dev/null 2>&1; then
    return 0
  fi
  return 1
}

# Test whether a Homebrew formula is already installed
formula_exists() {
    if $(brew list $1 >/dev/null); then
        success "${1} already installed"
        return 0
    fi
    warning "Missing formula: $1"
    return 1
}

# Create a symbolic link
link() {
  ln -fs $1 $2
}


install() {
  if [[ ! -d ${DOTFILES_DIRECTORY} ]]; then
    info "Installing the dotifiles"
    git clone --depth=1 https://github.com/sotayamashita/dotfiles.git ${DOTFILES_DIRECTORY} &> /dev/null
    success "Done. The dotfiles is installed"
  else
    info "The dotfiles has been installed"
  fi

  RETVAL="0"
}

update() {
  info "Updating the dotfiles"
  git -C $DOTFILES_DIRECTORY reset --hard HEAD
  git -C $DOTFILES_DIRECTORY clean -fd
  git -C $DOTFILES_DIRECTORY pull --rebase
  
  RETVAL="0"
}